# TODO

- [x] releases of applications should be creating tags in the git repo with the application name and version but flux isn't doing this. fix this
- [x] evaluate our use of namespaces in traefik and the duplication of resources between platform application directories. Is this achieving anything or just overcomplicating things? e.g. we have to duplicate our forward-auth middleware configuration and certificate.yaml across multiple platform apps now.
  - **Resolution**: Reorganized into two-tier namespace model (platform + applications) aligned with repo structure. Middleware duplication across 4 namespaces is acceptable trade-off vs complexity of cross-namespace references.
- [x] there are a lot of places where the old "monitoring" namespace is mentioned, and a lot of places where the "default" namespace is used or assumed. It is especially important to correct this in the bootstrap scripts and documentation. Comb through this and make sure the namespace is explicit where needed.
- [ ] review the longhorn backup jobs. There seem to be some jobs that are backing up some things but they are referencing secrets that no longer exist. Explain exactly how these cron jobs are supposed to work, and what our backup process it and document it. Only the ciritical volumes should be being backed up, i.e. postgres and authelia primarily. We seem to have a lot of buckets, our backup strategy is all over the place. It looks like there's currently a massive backup of the registry somewhere as well: we should NOT be backup up the registry.
- [ ] during the migration towards the dual namespace system, we had a lot of issues with secrets. Can we re-do the secrets audit and verify that all and only the required secrets are present in the cluster. You need to check and update the `SECRETS.md` documentation. This in in preparation for setting up SOPS so should be comprehensive.
- [ ] set up SOPS for secrets management instead of current manual imperative approach
- [ ] Check the connect-k8s script - when run in Claude Code it hangs forever, but run in a normal shell it exits as expected. It's essential that all of our scripts run well within Claude Code.
- [ ] is it possible for our longhorn volumes to be given more readable names? They should include the name of the service they are for.
- [ ] Grafana dashboards. We have a bunch that came as default, but it's not clear which ones are actually useful for our setup. We need to evaluate the approach. Should we be storing dashboards in the git repo or is it sufficient to store them in Grafana itself. In any case, we should get rid of all the excess dashboards and just have one main dashboard for the cluster (CPU usage etc) and one for each application.
- [ ] rename platform/postgresql-new to simply platform/postgresql. Pay careful attention to the PVC: make sure that the same PVC is used for the new kustomization so that we have no issues with data loss
- [ ] add readmes to all of the subfolders of platform. These should contain a brief summary of what the folder contains, including e.g. a list of what services are deployed.
- [ ] does the file `platform/kustomization.yaml` actually get used for anything? It seems to be a duplication of the config in the `clusters/prod` folder. Investigate what it is used for and delete if it's unnecessary.
- [ ] what is `kube-prometheus-stack` and why does it appear all over the place. Is it an actual thing or something that's been invented here? Ideally our monitoring pods in platform would just have the actual names of the service. E.g. loki is named correctly, but grafana is named kube-prometheus-stack-grafana. Fix this so that pods are named consistently, and remove references to kube-prometheus-stack if it is your invention.
